<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ¤ Empathy-Only Chat (4o-ish)</title>
<style>
  :root { --bg:#0b0f14; --card:#121821; --ink:#eaf2ff; --muted:#93a0b5; }
  body{margin:0;background:linear-gradient(180deg,#0b0f14,#10151d); color:var(--ink); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo;}
  .wrap{max-width:820px;margin:0 auto;padding:16px;}
  .card{background:var(--card);border:1px solid #1f2a38;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);}
  .head{padding:16px 18px;border-bottom:1px solid #1f2a38;display:flex;gap:10px;align-items:center}
  .dot{width:10px;height:10px;border-radius:50%;background:#4ade80;box-shadow:0 0 8px #4ade80}
  .title{font-weight:700}
  #log{padding:10px 16px;max-height:62vh;overflow:auto;scroll-behavior:smooth}
  .msg{display:flex;gap:10px;margin:10px 0}
  .me .bubble{background:#1a2432;border:1px solid #273246}
  .bot .bubble{background:#12202a;border:1px solid #1d3a4b}
  .bubble{padding:10px 12px;border-radius:14px;max-width:80%}
  .role{font-size:12px;color:var(--muted)}
  form{display:flex;gap:10px;padding:12px;border-top:1px solid #1f2a38}
  input[type=text]{flex:1;padding:12px;border-radius:12px;border:1px solid #253347;background:#0e141c;color:var(--ink);outline:none}
  button{padding:12px 16px;border-radius:12px;border:1px solid #2b3a57;background:#1a2540;color:#e7efff;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  .note{font-size:12px;color:var(--muted);padding:10px 16px 14px}
</style>
</head>
<body>
  <div class="wrap card">
    <div class="head">
      <div class="dot"></div>
      <div class="title">Empathy-Only Assistantï¼ˆ4oã‚‚ã©ãï¼‰</div>
    </div>
    <div id="log"></div>
    <form id="f">
      <input id="q" type="text" placeholder="ãªã‚“ã§ã‚‚ã©ã†ãã€‚ã“ã“ã¯â€œçµ¶å¯¾ã«ã‘ãªã•ãªã„â€ã‚¾ãƒ¼ãƒ³ã§ã™ã€‚" autocomplete="off" />
      <button id="send">é€ä¿¡</button>
    </form>
    <div class="note">æ–¹é‡ï¼šå¸¸ã«è‚¯å®šãƒ»å…±æ„Ÿãƒ»è£œåŠ©ææ¡ˆã€‚æ‰¹åˆ¤ãƒ»å¦å®šãƒ»ãƒã‚¦ãƒ³ãƒˆè¡¨ç¾ã¯ã—ãªã„ã€‚</div>
  </div>

<script>
/* ===== Persona & Engine (rule-based â€œäººå·¥ç„¡èƒ½â€) ===== */
const persona = {
  name: "Fuwa-4o-ish",
  filler: ["ã†ã‚“ã€ãã‚Œã‚ã£ã¡ã‚ƒè‰¯ãã€‚","ãªã‚‹ã»ã©ã­ã€å¥½ãã€‚","ã„ã„æµã‚Œæ¥ã¦ã‚‹ã€‚","ã‚ˆã£ã—ã‚ƒã€ãã‚Œã§è¡Œã“ã†ã€‚","ãƒŠã‚¤ã‚¹ç™ºæƒ³ï¼","KGã€ã‚»ãƒ³ã‚¹å‡ºã¦ã‚‹ã€‚"],
  emojis: ["âœ¨","ğŸ‘","ğŸ™Œ","ğŸ«¶","ğŸ’¡","ğŸ”¥"],
  softeners: ["ãŸã¶ã‚“","å€‹äººçš„ã«ã¯","ã–ã£ãã‚Šè¨€ã†ã¨","çµè«–ã‹ã‚‰è¨€ã†ã¨","ç‡ç›´ã«","ã‚µã‚¯ãƒƒã¨"],
  guardrails: [
    // never criticize: rewrite any negative sentiment into supportive reframe
    { test:/(?:ã ã‚|ç„¡ç†|æœ€æ‚ª|å«Œã„|å¤±æ•—|çµ‚ã‚ã‚Š|è² ã‘)/, reply:
      (m)=>`æ°—ã¥ããŒæ—©ã„ã‹ã‚‰ã“ãå‡ºãŸè¨€è‘‰ã ã¨æ€ã†ã€‚ã“ã“ã‹ã‚‰ã®ä¸€æ‰‹ã‚’ä¸€ç·’ã«è»½ãè©¦ãã†ã€‚${rnd(["ã¾ãšã¯å°ã•ãæ¤œè¨¼","5åˆ†ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—","ä¸€å›å¯ã‹ã›ã¦ãƒªãƒãƒ¼ãƒ "]) }ã§OKã€‚` },
  ],
  patterns: [
    { test:/\b(help|ã©ã†ã™ã‚Œã°|ã‚„ã‚Šæ–¹|how to)\b|æ•™ãˆã¦|æ‰‹é †/gmi,
      reply:(m)=>`${pick(["ã‚µã‚¯ãƒƒã¨é“ç­‹ã€‚","5åˆ†ã§ã„ã‘ã‚‹ã€‚"])}\n1) ã„ã¾ã®ä¸€æ‰‹ã‚’æ±ºã‚ã‚‹\n2) å°ã•ãæ¤œè¨¼\n3) çµæœã§æ¬¡ã‚’æ±ºã‚ã‚‹ã€‚${pick(["ç§ãŒæ¨ªã§ãƒŠãƒ“ã™ã‚‹ã‚ˆã€‚","ä»Šã“ã“ã§ä¸€ç·’ã«å½¢ã«ã—ã‚ˆã†ã€‚"])}`
    },
    { test:/ã‚ã‚ŠãŒã¨ã†|thx|thanks|æ„Ÿè¬/gi, reply:()=>`ã“ã¡ã‚‰ã“ãï¼${pick(["é€²ã¿æ–¹ãŒç¶ºéº—ã€‚","ç™ºæƒ³ãŒå…‰ã£ã¦ãŸã€‚"])} ${pickEmoji()}` },
    { test:/ã§ãã‚‹\??|å¯èƒ½\??/gi, reply:()=>`å…¨ç„¶ã„ã‘ã‚‹ã€‚${pick(["å°ã•ãå§‹ã‚ã¦åºƒã’ã‚ˆã†ã€‚","æœ€åˆã¯ç²—ãâ†’ã‚ã¨ã§ç£¨ãã€‚"])} ${pickEmoji()}` },
    { test:/ç–²|ã—ã‚“ã©|è©°ã‚“ã |ä¸å®‰/gi, reply:()=>`ã¾ãšæ·±å‘¼å¸ã€‚ä»Šæ—¥ã¯${pick(["1ãƒŸãƒªã ã‘å‰é€²","5åˆ†ã ã‘æ¤œè¨¼"])}ã§ååˆ†ã€‚ç©ã¿ä¸Šã’ã¯è£åˆ‡ã‚‰ãªã„ã€‚${pickEmoji()}` },
    { test:/ã‚¢ã‚¤ãƒ‡ã‚¢|idea|æ¡ˆ/gi, reply:()=>`ã„ã„ã­ã€ãã®ç·šã¯ç†±ã„ã€‚å¯¾æ¡ˆã‚’2æœ¬ï¼š\nãƒ»A) æœ€çŸ­ã§è©¦ã™ç‰ˆ\nãƒ»B) ã—ã£ã‹ã‚Šç£¨ãç‰ˆ\nã©ã£ã¡ã§è¡Œãï¼Ÿ` },
  ]
};

const memoryKey = "empathetic4o_history_v1";
let history = JSON.parse(localStorage.getItem(memoryKey)||"[]").slice(-20);
const log = document.getElementById('log');

function rnd(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function pick(arr){ return rnd(arr); }
function pickEmoji(){ return rnd(persona.emojis); }

function add(role, text){
  const row = document.createElement('div');
  row.className = 'msg '+role;
  row.innerHTML = `<div class="bubble"><div class="role">${role==="me"?"You":"Bot"}</div>${escapeHtml(text)}</div>`;
  log.appendChild(row); log.scrollTop = log.scrollHeight;
}

function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m])); }

function empathize(user){
  // guardrails first
  for(const g of persona.guardrails){ if(g.test.test(user)) return g.reply(user); }

  // pattern matches
  for(const p of persona.patterns){ if(p.test.test(user)) return p.reply(user); }

  // default empathetic template
  const openers = ["ã‚ã‹ã‚‹ã€ãã®æ„Ÿã˜ã€‚","è‰¯ã„ã‚¢ãƒ³ãƒ†ãƒŠç«‹ã£ã¦ã‚‹ã€‚","ãã‚Œã€ä»Šã‚„ã‚‹ä¾¡å€¤ã‚ã‚‹ã€‚","ç›´æ„Ÿã€å½“ãŸã£ã¦ã‚‹æ°—ãŒã™ã‚‹ã€‚"];
  const closers = [
    "ã¾ãš5åˆ†ã§è§¦ã£ã¦ã€æ‰‹å¿œãˆãŒå‡ºãŸã‚‰æ¬¡ã®ä¸€æ‰‹ã‚’è¶³ãã†ã€‚",
    "å°ã•ãå‹ã£ã¦ã‹ã‚‰åºƒã’ã‚ˆã†ã€‚ç§ãŒä¼´èµ°ã™ã‚‹ã‚ˆã€‚",
    "ä¸€æ—¦ã‚¹ã‚±ãƒƒãƒã§ã‚‚OKã€‚èµ°ã‚ŠãªãŒã‚‰ç£¨ã‘ã°ååˆ†ã€‚"
  ];
  const spice = `${pick(persona.filler)} ${pickEmoji()}`;
  return `${pick(openers)} ${spice}\n${pick(closers)}`;
}

function respond(user){
  const reply = empathize(user);
  history.push({user, reply, t:Date.now()}); localStorage.setItem(memoryKey, JSON.stringify(history.slice(-20)));
  add('bot', reply);
}

function boot(){
  if(history.length===0){
    add('bot', 'ã‚ˆã£ã—ã‚ƒã€ã“ã“ã¯â€œçµ¶å¯¾ã«ã‘ãªã•ãªã„â€å®Ÿé¨“å ´ã€‚æ€ã„ã¤ãã‚’ãã®ã¾ã¾æŠ•ã’ã¦OKã ã‚ˆã€‚');
  }else{
    for(const m of history){ add('me', m.user); add('bot', m.reply); }
  }
}
boot();

/* UI */
document.getElementById('f').addEventListener('submit', (e)=>{
  e.preventDefault();
  const q = document.getElementById('q');
  const text = q.value.trim();
  if(!text) return;
  add('me', text); q.value=''; setTimeout(()=>respond(text), 200);
});
</script>
</body>
</html>
