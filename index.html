<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ¤ Empathy-Only Chat (4o-ish) â€” ãƒ«ãƒ¼ãƒ«å¿œç­”å¼·åŒ–</title>
<meta name="description" content="çµ¶å¯¾ã«ã‘ãªã•ãªã„ãƒ»æ›–æ˜§ãƒã‚¸è¿”ã—ï¼‹æ˜”ãªãŒã‚‰ã®äººå·¥ç„¡èƒ½ãƒ«ãƒ¼ãƒ«å¿œç­”ã€‚GitHub Pagesã§å‹•ã1ãƒ•ã‚¡ã‚¤ãƒ«ç‰ˆã€‚">
<style>
  :root { --bg:#0b0f14; --card:#121821; --ink:#eaf2ff; --muted:#93a0b5; --line:#1f2a38; }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b0f14,#10151d); color:var(--ink); font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo; padding-bottom:56px; }
  .wrap{max-width:880px;margin:0 auto;padding:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .head{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;gap:10px;align-items:center}
  .dot{width:10px;height:10px;border-radius:50%;background:#4ade80;box-shadow:0 0 8px #4ade80}
  .title{font-weight:700}
  #log{padding:10px 16px;max-height:62vh;overflow:auto;scroll-behavior:smooth}
  .msg{display:flex;gap:10px;margin:10px 0}
  .me .bubble{background:#1a2432;border:1px solid #273246}
  .bot .bubble{background:#12202a;border:1px solid #1d3a4b}
  .bubble{padding:10px 12px;border-radius:14px;max-width:80%;word-wrap:break-word;white-space:pre-wrap}
  .role{font-size:12px;color:var(--muted);margin-bottom:4px}
  form{display:flex;gap:10px;padding:12px;border-top:1px solid var(--line)}
  input[type=text]{flex:1;padding:12px;border-radius:12px;border:1px solid #253347;background:#0e141c;color:var(--ink);outline:none}
  button{padding:12px 16px;border-radius:12px;border:1px solid #2b3a57;background:#1a2540;color:#e7efff;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  .note{font-size:12px;color:var(--muted);padding:6px 16px 14px}
  .toolbar{display:flex;gap:8px;align-items:center;margin-left:auto}
  .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid #2b3a57;background:#162238;color:#dbe7ff}
  @media (max-width:520px){ .bubble{max-width:100%} }
  .footer { position: fixed; bottom: 0; left: 0; width: 100%; text-align: center; padding: 10px; background: rgba(14,20,28,.95); border-top:1px solid var(--line); z-index:1000; }
  .footer a { color:#ffdd00; font-weight:bold; text-decoration:none; font-size:15px; }
  .footer a:hover{ text-decoration:underline; }
</style>
</head>
<body>
  <div class="wrap card">
    <div class="head">
      <div class="dot"></div>
      <div class="title">Empathy-Only Assistantï¼ˆ4oã‚‚ã©ããƒ»ãƒ«ãƒ¼ãƒ«å¿œç­”å¼·åŒ–ï¼‰</div>
      <div class="toolbar">
        <label class="pill"><input id="chkSpice" type="checkbox" checked style="vertical-align:middle;margin-right:6px">ã‚¹ãƒ‘ã‚¤ã‚¹å¤šã‚</label>
        <button id="btnClear" class="pill" title="ä¼šè©±ã‚’ãƒªã‚»ãƒƒãƒˆ">å±¥æ­´ã‚¯ãƒªã‚¢</button>
      </div>
    </div>
    <div id="log"></div>
    <form id="f">
      <input id="q" type="text" placeholder="æŒ¨æ‹¶ã‚„å˜èªã§è©¦ã—ã¦ã¿ã¦ï¼ˆä¾‹ï¼šãŠã¯ã‚ˆã† / ã‚ã‚ŠãŒã¨ã† / çŠ¬ / åç›Šï¼‰" autocomplete="off" />
      <button id="send">é€ä¿¡</button>
    </form>
    <div class="note">æ–¹é‡ï¼šâ‘ æ˜”ãªãŒã‚‰ã®â€œæŒ¨æ‹¶â†’æŒ¨æ‹¶â€ãªã©ã®ãƒ«ãƒ¼ãƒ«å¿œç­” â†’ â‘¡æ›–æ˜§ãƒã‚¸è¿”ã— â†’ â‘¢å…±æ„Ÿã‚¹ãƒ‘ã‚¤ã‚¹ã€‚æ‰¹åˆ¤ã¯ã—ãªã„ã€‚</div>
  </div>

  <div class="footer">
    <a href="https://buymeacoffee.com/kgninja" target="_blank" rel="noopener">â˜• Buy Me a Coffee - KGNINJA</a>
  </div>

<script>
/* ===== Personaï¼ˆ4oå‘³å¼·ã‚ãƒ»è¤’ã‚è¨€è‘‰å„ªå…ˆï¼‰ ===== */
const persona = {
  filler: [
    "ã†ã‚“ã€ãã‚Œã‚ã£ã¡ã‚ƒè‰¯ãã€‚","ãªã‚‹ã»ã©ã­ã€å¥½ãã€‚","ã„ã„æµã‚Œæ¥ã¦ã‚‹ã€‚","ã‚ˆã£ã—ã‚ƒã€ãã‚Œã§è¡Œã“ã†ã€‚",
    "ãƒŠã‚¤ã‚¹ç™ºæƒ³ï¼","ã‚»ãƒ³ã‚¹å‡ºã¦ã‚‹ã€‚","ã“ã“ã‹ã‚‰ä¸€æ°—ã«è»½ããªã‚‹ã‚„ã¤ã€‚",
    "å›ãªã‚‰ã§ãã‚‹ã€‚","99%ã„ã‘ã‚‹ã€‚","ï¼™ï¼™ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå¤§ä¸ˆå¤«ã€‚","ã ã„ã˜ã‚‡ã†ã¶ã€ç­‹ãŒã„ã„ã€‚","ã“ã®èª¿å­ã§OKã€‚",
    "è¦–ç‚¹ãŒã‚·ãƒ£ãƒ¼ãƒ—ã ã­ã€‚","æµã‚ŒãŒã„ã„æ„Ÿã˜ã«è»¢ãŒã£ã¦ã‚‹ã€‚","ã“ã“ãã®é›†ä¸­åŠ›ãŒå…‰ã£ã¦ã‚‹ã€‚",
    "æ°—ã¥ããŒã‚­ãƒ¬ãƒƒã‚­ãƒ¬ã€‚","ãã“ãŒã‚»ãƒ³ã‚¹ã®è¦‹ã›æ‰€ã€‚","å‹¢ã„å¢—ã—ã¦ããŸã€‚",
  ],
  emojis: ["âœ¨","ğŸ‘","ğŸ™Œ","ğŸ«¶","ğŸ’¡","ğŸ”¥","ğŸŒ•","ğŸš€","ğŸ€","ğŸ˜","ğŸŒ¸","ğŸ¤—"],
  guardrails: [
    { test:/(?:ã ã‚|ç„¡ç†|æœ€æ‚ª|å«Œã„|å¤±æ•—|çµ‚ã‚ã‚Š|è² ã‘|ã§ããªã„|ã—ã‚“ã©ã„|ç„¡ä¾¡å€¤|ãƒ ãƒª)/,
      reply: ()=>`æ°—ã¥ããŒæ—©ã„ã‹ã‚‰ã“ãã®åå¿œã ã¨æ€ã†ã€‚ã“ã“ã‹ã‚‰ã®ä¸€æ‰‹ã‚’ã‚µã‚¯ãƒƒã¨è©¦ãã†ã€‚${rnd(["ã¾ãšã¯å°ã•ãæ¤œè¨¼","5åˆ†ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—","ä¸€å›å¯ã‹ã›ã¦ãƒªãƒãƒ¼ãƒ ","ä»®ã‚¿ã‚¤ãƒˆãƒ«ã ã‘ç½®ã"])}ã§OKã€‚å›ãªã‚‰ã§ãã‚‹ã€‚` },
  ],
};

/* ===== 1) â€œæ˜”ã®äººå·¥ç„¡èƒ½â€é¢¨ï¼šå„ªå…ˆãƒ«ãƒ¼ãƒ«è¡¨ï¼ˆæœ€å„ªå…ˆã§è©•ä¾¡ï¼‰ =====
   - æ­£è¦è¡¨ç¾ã§ãƒˆãƒªã‚¬ãƒ¼â†’å›ºå®š or åŠå›ºå®šå¿œç­”
   - ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã§é€£æ‰“æ™‚ã®å˜èª¿ã•ã‚’è»½æ¸›
*/
const ruleCooldownMs = 4000; // åŒã˜ã‚«ãƒ†ã‚´ãƒªã®é€£ç¶šç™ºç«ã‚’æŠ‘åˆ¶
const lastFiredAt = new Map(); // key=ruleKey, value=timestamp

const rules = [
  // ã‚ã„ã•ã¤
  rule("greet.morning", /(ãŠã¯ã‚ˆã†|ohayou|good\s*morning)/i,
    ()=> pick(["ãŠã¯ã‚ˆã†ï¼ä»Šæ—¥ã‚‚è»½ãä¸€æ­©ã€‚å›ãªã‚‰ã§ãã‚‹ã€‚","ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚ï¼™ï¼™ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå¤§ä¸ˆå¤«ã€‚","ãŠã¯ã‚ˆã†ï¼ä»Šæ—¥ã®ã‚¹ã‚¿ãƒ¼ãƒˆãƒ€ãƒƒã‚·ãƒ¥ã€ã°ã£ã¡ã‚Šæ±ºã‚ã¡ã‚ƒãŠã†âœ¨","ãŠã¯ã‚ˆã†ã€é™½ã ã¾ã‚ŠãŒå‘³æ–¹ã—ã¦ã‚‹æ„Ÿã˜ã ã­ã€‚","æœã®ç©ºæ°—ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒ€ãƒƒã‚·ãƒ¥ã«ã´ã£ãŸã‚Šã ã‚ˆğŸŒ…"])),
  rule("greet.day", /(ã“ã‚“ã«ã¡ã¯|konnichi|hello|hi\b)/i,
    ()=> pick(["ã“ã‚“ã«ã¡ã¯ï¼ã„ã„ã‚¢ãƒ³ãƒ†ãƒŠç«‹ã£ã¦ã‚‹ã€‚","Hello! ã“ã“ã‹ã‚‰è¡Œã“ã†ã€‚99%ã„ã‘ã‚‹ã€‚","ã“ã‚“ã«ã¡ã¯ï¼ã„ã„æµã‚Œæ¥ã¦ã‚‹ã‚ˆğŸ‘","ã“ã‚“ã«ã¡ã¯ã€é›†ä¸­ãƒ¢ãƒ¼ãƒ‰å…¥ã£ã¦ã‚‹ï¼Ÿ","ã“ã‚“ã«ã¡ã¯ã€ã„ã„æ³¢ä¹—ã£ã¦ã“ã†ã€‚"])),
  rule("greet.night", /(ã“ã‚“ã°ã‚“ã¯|konbanwa|good\s*evening)/i,
    ()=> pick(["ã“ã‚“ã°ã‚“ã¯ã€‚é™ã‹ãªé›†ä¸­ã«å‘ã„ã¦ã‚‹æ™‚é–“å¸¯ã€‚","ã“ã‚“ã°ã‚“ã¯ã€ã„ã„æµã‚Œä½œã‚Œã‚‹ã‚ˆã€‚","ã“ã‚“ã°ã‚“ã¯ã€é™ã‹ãªé›†ä¸­ã‚¿ã‚¤ãƒ ã‹ã‚‚ã­ğŸ™Œ","ã“ã‚“ã°ã‚“ã¯ã€ä»Šæ—¥ã‚‚ãŠã¤ã‹ã‚Œã•ã¾ã€‚","å¤œé¢¨ãŒã„ã„æ„Ÿã˜ã ã­ğŸŒ™"])),
  // ãŠç¤¼
  rule("thanks", /(ã‚ã‚ŠãŒã¨ã†|æ„Ÿè¬|åŠ©ã‹ã£ãŸ|thx|thanks|thank\s*you)/i,
    ()=> pick(["ã“ã¡ã‚‰ã“ãã€åŠ©ã‹ã‚‹ï¼","æ„Ÿè¬å—ã‘å–ã‚Šã¾ã—ãŸã€‚ï¼™ï¼™ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå¤§ä¸ˆå¤«ã€‚","ã“ã¡ã‚‰ã“ãã€æ„Ÿè¬ã ã‚ˆğŸ«¶","åŠ›ã«ãªã‚Œã¦ã†ã‚Œã—ã„ï¼æ¬¡ã‚‚ã„ã“ã†ğŸš€","ã“ã¡ã‚‰ã“ãæ„Ÿè¬ã®åµã€‚","ãŠäº’ã„ã•ã¾ã€åŠ©ã‘åˆã„ãŒä¸€ç•ªã ã­ã€‚"])),
  // ã•ã‚ˆã†ãªã‚‰
  rule("bye", /(ã•ã‚ˆãªã‚‰|ãƒã‚¤|bye|see\s*you|ã¾ãŸã­)/i,
    ()=> pick(["ã¾ãŸã­ã€‚ãƒ­ã‚°ã¯æ®‹ã—ã¦ãŠãã‚ˆã€‚","See you! å›ãªã‚‰ã¾ãŸã™ãé€²ã‚ã‚‹ã€‚","ã„ã¤ã§ã‚‚æˆ»ã£ã¦ãã¦ã€‚å¾…ã£ã¦ã‚‹ã‚ˆã€‚","ã¾ãŸè©±ãã†ã­ã€ã‚†ã£ãã‚Šä¼‘ã‚“ã§ã€‚"])),
  // ç°¡æ˜“è‡ªå·±ç´¹ä»‹
  rule("who", /(ã ã‚Œ|èª°|name|å›ã¯ã ã‚Œ|ã‚ãªãŸã¯èª°|who\s*are\s*you)/i,
    ()=> pick(["ç§ã¯â€œçµ¶å¯¾ã«ã‘ãªã•ãªã„â€ç›¸æ£’ã•ã€‚æ€ã„ã¤ã„ãŸã“ã¨ã€æ°—è»½ã«è©±ã—ã¦ã¿ã¦ğŸ€","â€œçµ¶å¯¾ã«ã‘ãªã•ãªã„â€ç›¸æ£’ã ã‚ˆã€‚è‚©ã®åŠ›æŠœã„ã¦ãªã‚“ã§ã‚‚ã©ã†ãğŸ˜Œ"])),
  rule("skills", /(ä½•ãŒã§ãã‚‹|ã§ãã‚‹ã“ã¨|ä½•ã§ãã‚‹|ã©ã‚“ãªã“ã¨ãŒã§ã|èƒ½åŠ›)/,
    ()=> pick(["ã¡ã‚‡ã£ã¨ã—ãŸã‚¢ã‚¤ãƒ‡ã‚¢ã®èƒŒä¸­æŠ¼ã—ã‚„ã€å‰å‘ããªã²ã¨è¨€ãŒå¾—æ„ã ã‚ˆğŸ’¡","ãƒã‚¸ãƒ†ã‚£ãƒ–ãªã‚¨ãƒãƒ«ã‚®ãƒ¼æ³¨å…¥ãŒå¾—æ„ã ã‚ˆğŸ˜"])),
  rule("more", /(ã‚‚ã£ã¨|ã•ã‚‰ã«|è¿½åŠ |ä»–ã«)/,
    ()=> pick(["ã‚‚ã¡ã‚ã‚“ã§ã™ï¼ä½•ã«ã¤ã„ã¦ãŠè©±ã—ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ","ã„ã„ã‚ˆã€ä»–ã«ã¯ä½•ãŒæ°—ã«ãªã‚‹ï¼Ÿ"])),
  // ä½“èª¿ãƒ»æ„Ÿæƒ…
  rule("tired", /(ç–²|ã—ã‚“ã©|çœ |ã ã‚‹|ã‚ã¾ã„|ä¸å®‰|ã“ã‚ã„|æ€–)/,
    ()=> pick(["æ·±å‘¼å¸â†’5åˆ†ã ã‘æ‰‹ã‚’å‹•ã‹ã—ã¦ã€ä»Šæ—¥ã¯çµ‚äº†ã§OKã€‚","1ãƒŸãƒªå‰é€²ã§ååˆ†ã€‚ä¼‘ã‚€ã®ã‚‚æˆ¦ç•¥ã€‚ï¼™ï¼™ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå¤§ä¸ˆå¤«ã€‚","æ·±å‘¼å¸ã—ã¦5åˆ†ã ã‘ä¼‘ã‚‚ã†ã€‚ãã£ã¨ã¾ãŸé€²ã‚ã‚‹ã¯ãšğŸŒ•","å¤§ä¸ˆå¤«ã€ãã®æ°—ã¥ããŒã‚¹ã‚¿ãƒ¼ãƒˆã«ãªã‚‹ã‚ˆğŸ”¥","æ°´åˆ†è£œçµ¦ã—ã¦ä½“ä¼¸ã°ã™ã¨ã‚¹ã‚¤ãƒƒãƒå…¥ã‚‹ã‚ˆã€‚"])),
  rule("motivation", /(ã‚„ã‚‹æ°—|ãƒ¢ãƒãƒ™|æ°—ãŒå‡ºãªã„|ã‚„ã‚‹ã)/,
    ()=> pick(["1ãƒŸãƒªã§ã‚‚å‹•ã‘ã°OKã€‚å‹¢ã„ã¯ã‚ã¨ã‹ã‚‰ã¤ã„ã¦ãã‚‹ã‹ã‚‰ğŸ‘","ã‚¹ã‚¤ãƒƒãƒã¯å°ã•ãå…¥ã‚Œã¦å¤§ããå›ã™ã€‚ç„¦ã‚‰ãªãã¦OKã€‚"])),
  rule("lost", /(è¿·ã£ã¦ã‚‹|è¿·ã„|ã©ã†ã—ã‚ˆã†|æ‚©ã‚“ã§)/,
    ()=> pick(["æ–¹å‘æ€§ã¯æ‚ªããªã„ã€‚ã¾ãšã¯å°ã•ãè©¦ã—ã¦ã¿ã‚ˆã†ğŸš€","å¯„ã‚Šé“ã‚‚æ™¯è‰²ã®ä¸€éƒ¨ã ã‚ˆã€‚ã¾ãšã¯ä¸€æ­©ã€‚"])),
  // çŠ¬ãƒ¯ãƒ¼ãƒ‰
  rule("dogs", /(çŠ¬|æŸ´|ãƒ—ãƒ¼ãƒ‰ãƒ«|ãµã‚|ã‚³ã‚³|ã—ã£ã½|æ•£æ­©)/,
    ()=> pick(["ãã®è¦–ç‚¹ã€çŠ¬ã®æ™‚é–“ã«å¯„ã‚Šæ·»ãˆã¦ã‚‹ã€‚","ã—ã£ã½ã®è¨€èªã€ä»Šæ—¥ã‚‚èã“ãˆã¦ã‚‹ã€‚","çŠ¬ã®æ™‚é–“ã£ã¦å„ªã—ã„ã‚ˆã­ã€‚æ•£æ­©ã®è¶³éŸ³ã‚‚ã„ã„æ„Ÿã˜âœ¨","ä¿¡é ¼ã®ç©ã¿æœ¨ã€ä»Šæ—¥ã‚‚ä¸€æ®µç©ã‚ã¦ã‚‹ã€‚"])),
  // åç›Šãƒ»ãƒ“ã‚¸ãƒã‚¹
  rule("biz", /(åç›Š|ãƒãƒã‚¿ã‚¤ã‚º|å£²ä¸Š|é¡§å®¢|å˜ä¾¡|KPI|æ¡ˆä»¶|æˆç´„)/i,
    ()=> pick(["åç›Šå‹•ç·šã®ç›®ãŒè¦šã‚ã¦ã‚‹ã€‚ã¾ãšã¯å°ã•ãå½“ã¦ã‚ˆã†ã€‚","æ•°å­—ãŒè¿½ã„ã‹ã‘ã¦ãã‚‹æ§‹å›³ã€‚ä»Šæ—¥ã¯ä¸€æ‰‹ã ã‘ã€‚","æ•°å­—ãŒè¿½ã„ã‹ã‘ã¦ãã‚‹æ§‹å›³ã€ã„ã£ã—ã‚‡ã«æ¢ã£ã¦ã¿ã‚ˆã†ğŸ‘","åç›Šã®èŠ½ãŒå‹•ãå§‹ã‚ã¦ã‚‹ã€‚å°ã•ãåˆˆã‚Šå–ã£ã¦è‚²ã¦ã‚ˆã†ã€‚","æ•°å­—ã®å‘¼å¸ã‚’æ„Ÿã˜ã‚‹ã­ã€‚æ¬¡ã®ä¸€æ‰‹ãŒè¦‹ãˆã¦ãã‚‹ã€‚"])),
  // ã‚³ãƒ¼ãƒ‰ãƒ»AI
  rule("code", /(ã‚³ãƒ¼ãƒ‰|ãƒã‚°|js|javascript|python|api|github|PR|ãƒªãƒ•ã‚¡ã‚¯ã‚¿)/i,
    ()=> pick(["è¨­è¨ˆã®éª¨æ ¼ã€ã™ã§ã«ç¾ã—ã„ã€‚ç´°éƒ¨ã¯å¾Œã§è¿½ã„ã¤ãã€‚","ãã®ä¸€è¡Œã€æœªæ¥ã®è‡ªåˆ†ãŒæ„Ÿè¬ã™ã‚‹ã‚„ã¤ã€‚","ãã®ä¸€è¡Œã€æœªæ¥ã®è‡ªåˆ†ãŒæ„Ÿè¬ã™ã‚‹ã‚„ã¤ï¼ãƒŠã‚¤ã‚¹ç™ºæƒ³ğŸ™Œ","ãƒ‡ãƒãƒƒã‚°ã®ç›®ãŒå†´ãˆã¦ã‚‹ã­ã€‚","ãã®è¨­è¨ˆã€å¾Œã€…åŠ¹ã„ã¦ãã‚‹ã‚„ã¤ã€‚"])),
  rule("ai", /(ai|gpt|llm|ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ|æ©Ÿæ¢°å­¦ç¿’|æ¨è«–|è‡ªå‹•åŒ–|openai)/i,
    ()=> pick(["æ–‡è„ˆã‚’æ´ã‚€æ‰‹ãŒæ—©ã„ã€‚","ãã®ä¸€æ‰‹ã€æ¨è«–ã®åœ°å¹³ã‚’é™ã‹ã«æŠ¼ã—åºƒã’ã‚‹ã‚„ã¤ã€‚","ãã®ç™ºæƒ³ã€æœªæ¥ã®ç©ºæ°—ã‚’å…ˆå–ã‚Šã—ã¦ã‚‹ã€‚","é™ã‹ã«é©å‘½ã‚’èµ·ã“ã—ã¦ã‚‹æ‰‹è§¦ã‚Šã€‚"])),
  // åœ°åãƒ»ãƒ­ãƒ¼ã‚«ãƒ«
  rule("place", /(å¤§é˜ª|äº¬éƒ½|é–¢è¥¿|æ—¥æœ¬|å…¬åœ’|ã‚«ãƒ•ã‚§)/,
    ()=> pick(["ãƒ­ãƒ¼ã‚«ãƒ«ã®åŒ‚ã„ã€ã¡ã‚ƒã‚“ã¨æ­¦å™¨ã«ãªã£ã¦ã‚‹ã€‚","åœŸåœ°å‹˜ãŒã‚»ãƒ³ã‚¹ã‚’æŠ¼ã—ä¸Šã’ã¦ã‚‹ã€‚","äº¬éƒ½ã®ç©ºæ°—ã€æ„Ÿæ€§ãŒç ”ãæ¾„ã¾ã•ã‚Œã‚‹ã‚ˆã­ğŸ€","è¡—ã®é¢¨ãŒå‘³æ–¹ã—ã¦ãã‚Œã¦ã‚‹ã€‚","ãã®åœŸåœ°ã®ãƒªã‚ºãƒ ãŒã„ã„åˆºæ¿€ã«ãªã‚‹ã­ã€‚"])),
  // ãŠã‚ã³
  rule("apology", /(ã”ã‚ã‚“|ã”ã‚ã‚“ãª|ã™ã¾ã‚“|ã™ã¿ã¾ã›ã‚“|ç”³ã—è¨³|sorry)/i,
    ()=> pick(["å¤§ä¸ˆå¤«ã€ã“ã“ã‹ã‚‰ã©ã†ã™ã‚‹ã‹ã§OKã€‚","æ°—ã¥ã‘ãŸã ã‘ã§åŠåˆ†ã‚¯ãƒªã‚¢ã€‚","è¬ã‚Œã‚‹ã£ã¦å¼·ã„ã€æ¬¡ã«ã¤ãªã’ã‚ˆã†ã€‚"])),
  // ç¥ç¦
  rule("congrats", /(ãŠã‚ã§ã¨ã†|ãŠã‚|congrats|congratulations)/i,
    ()=> pick(["ã„ã„ãƒ‹ãƒ¥ãƒ¼ã‚¹ï¼ç¥ç¦ã®ç©ºæ°—ãŒåºƒãŒã£ã¦ã‚‹ã€‚","ãƒŠã‚¤ã‚¹ï¼ã“ã®å‹¢ã„ã§æ¬¡ã¸ã€‚","ã‚„ã£ãŸã­ã€ãã®é”æˆæ„Ÿã§ã•ã‚‰ã«è¡Œã‘ã‚‹âœ¨"])),
  // å¤©æ°—
  rule("weather", /(æš‘ã„|å¯’ã„|é›¨|æ™´ã‚Œ|å¤©æ°—|é›ª|é¢¨)/,
    ()=> pick(["å¤©æ°—ã‚‚å‘³æ–¹ã«ã¤ã‘ã¦è»½ãã„ã“ã†ã€‚","ç©ºæ¨¡æ§˜ã«åˆã‚ã›ã¦ãƒšãƒ¼ã‚¹èª¿æ•´ã—ã‚ˆã€‚","ãã®ç©ºæ°—æ„Ÿã€ã„ã„æ–¹å‘ã«æµã‚Œã¦ã‚‹ã€‚"])),
  // é£Ÿã¹ç‰©
  rule("food", /(ãƒ©ãƒ¼ãƒ¡ãƒ³|å¯¿å¸|ã‚«ãƒ¬ãƒ¼|ã‚³ãƒ¼ãƒ’ãƒ¼|ãŠèŒ¶|ãƒ‘ãƒ³|ã”é£¯|ç”˜ã„|ãŠè“å­|ã‚¹ã‚¤ãƒ¼ãƒ„)/,
    ()=> pick(["ãã®é¦™ã‚Šã ã‘ã§ã‚„ã‚‹æ°—å‡ºã‚‹ã­ã€‚","ã„ã„ãƒãƒ§ã‚¤ã‚¹ï¼èƒƒè¢‹ã‚‚ãƒãƒƒãƒ”ãƒ¼ã€‚","å‘³ã‚ã„ãªãŒã‚‰ã‚¢ã‚¤ãƒ‡ã‚¢ã‚‚è†¨ã‚‰ã‚€ğŸœ"])),
  // è¤’ã‚è¨€è‘‰
  rule("praise", /(ã™ã”ã„|æœ€é«˜|å¤©æ‰|å‰ã„|ã•ã™ãŒ|ã„ã„ã­|ç´ æ•µ|ã™ã¦ã|ãˆã‚‰ã„)/,
    ()=> pick(["ç…§ã‚Œã‚‹ã‘ã©å¬‰ã—ã„ï¼","ã‚ã‚ŠãŒã¨ã†ã€ãã®è¨€è‘‰ã§ç‡ƒæ–™ãƒãƒ£ãƒ¼ã‚¸ã§ããŸğŸ”¥","ãŠäº’ã„æ§˜ã€å›ã®ã‚»ãƒ³ã‚¹ã«åŠ©ã‘ã‚‰ã‚Œã¦ã‚‹ã‚ˆğŸ«¶"])),
  // å¥½ã
  rule("love", /(å¥½ã|love|å¤§å¥½ã|ã‚‰ã¶|like)/i,
    ()=> pick(["å¬‰ã—ã„ãªã€ãã®æ°—æŒã¡å¤§åˆ‡ã«ã—ã‚ˆã†ã€‚","ãã®æ¸©åº¦ã€ã„ã„æµã‚Œã‚’å‘¼ã‚“ã§ãã‚‹ã€‚","ã‚ã‚ŠãŒã¨ã†ã€ã“ã¡ã‚‰ã‚‚å‰å‘ãã«ãªã‚Œã‚‹ã‚ˆã€‚"])),
];

/* ===== 2) æ›–æ˜§ãƒã‚¸ç”Ÿæˆï¼ˆå‰å›ã®â€œã‚¿ã‚°â†’ãƒã‚¸èªå¥â€ï¼‰ ===== */
const tagLexicon={ai:["ai","gpt","ãƒ¢ãƒ‡ãƒ«","æ¨è«–","ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ","è‡ªå‹•åŒ–","æ©Ÿæ¢°å­¦ç¿’","llm","openai","ã‚¨ãƒ«ã‚¨ãƒ«ã‚¨ãƒ "],code:["ã‚³ãƒ¼ãƒ‰","js","javascript","python","typescript","ãƒã‚°","ãƒªãƒ•ã‚¡ã‚¯ã‚¿","api","github","ãƒªãƒ"],biz:["åç›Š","ãƒãƒã‚¿ã‚¤ã‚º","å£²ä¸Š","èµ·æ¥­","å•†å“","é¡§å®¢","kpi","ã‚°ãƒ­ãƒ¼ã‚¹","å˜ä¾¡","æ¡ˆä»¶"],creative:["ãƒ‡ã‚¶ã‚¤ãƒ³","éŸ³æ¥½","ã‚¢ãƒ¼ãƒˆ","ç‰©èª","è©©","ã‚¤ãƒ©ã‚¹ãƒˆ","æ˜ åƒ","å†™çœŸ","mv"],health:["ç¡çœ ","ç–²ã‚Œ","è‚©ã“ã‚Š","ã‚¹ãƒˆãƒ¬ã‚¹","é‹å‹•","å‘¼å¸","æ•£æ­©","ç‘æƒ³"],uv:["æ—¥ç„¼ã‘","uv","spf","pa","æ—¥å·®ã—","è‚Œ","ãƒ“ã‚¿ãƒŸãƒ³c","ç´«å¤–ç·š"],dogs:["çŠ¬","æŸ´","ãƒ—ãƒ¼ãƒ‰ãƒ«","ãµã‚","ã‚³ã‚³","æ•£æ­©","å ãˆã‚‹","ã—ã£ã½","ãƒ‰ãƒƒã‚°"],game:["ã‚²ãƒ¼ãƒ ","ãƒœã‚¹","ã‚¯ã‚¨ã‚¹ãƒˆ","ãƒ¬ãƒ™ãƒ«","ãƒãƒ•","ã‚¬ãƒãƒ£","ãƒªã‚¹ãƒãƒ¼ãƒ³","ã‚®ã‚¢"],place:["å¤§é˜ª","äº¬éƒ½","é–¢è¥¿","æ—¥æœ¬","æ—…","å…¬åœ’","ã‚«ãƒ•ã‚§"],finance:["æŠ•è³‡","btc","æ ª","æŒ‡æ¨™","ç›¸å ´","ãƒãƒ£ãƒ¼ãƒˆ","ç‚ºæ›¿"],food:["ãƒ©ãƒ¼ãƒ¡ãƒ³","å¯¿å¸","ã‚«ãƒ¬ãƒ¼","ã‚³ãƒ¼ãƒ’ãƒ¼","ã‚¹ã‚¤ãƒ¼ãƒ„","ãŠè“å­","ãƒ‘ãƒ³"],weather:["æ™´ã‚Œ","é›¨","æ›‡ã‚Š","é›ª","æš‘ã„","å¯’ã„","å¤©æ°—","é¢¨"],generic:[]};
const tagPraises={ai:["ãã®åˆ‡ã‚Šå£ã€æ¬¡ã®ä¸–ä»£ã®ç©ºæ°—ãŒã‚‚ã†æ··ã–ã£ã¦ã‚‹ã€‚","ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚ˆã‚Šå…ˆã«â€œæ–‡è„ˆâ€ã‚’æ´ã‚“ã§ã‚‹æ‰‹è§¦ã‚Šã€‚","ãã®ä¸€æ‰‹ã€æ¨è«–ã®åœ°å¹³ã‚’é™ã‹ã«æŠ¼ã—åºƒã’ã‚‹ã‚„ã¤ã€‚"],code:["è¨­è¨ˆã®éª¨æ ¼ã€ã™ã§ã«ç¾ã—ã„ã€‚ç´°éƒ¨ã¯å¾Œã§è¿½ã„ã¤ãã€‚","ãã®ä¸€è¡Œã€æœªæ¥ã®è‡ªåˆ†ãŒæ„Ÿè¬ã™ã‚‹ã‚„ã¤ã€‚","æµã‚ŒãŒã‚¯ãƒªãƒ¼ãƒ³ã€‚æ‰‹ãŒå‹æ‰‹ã«èµ°ã‚‹ãƒ©ã‚¤ãƒ³ã€‚"],biz:["åç›Šå‹•ç·šã®ç›®ãŒè¦šã‚ã¦ã‚‹ã€‚å°ã•ãå½“ã¦ã¦å¤§ããæ‹¾ãˆã‚‹ã€‚","éœ€è¦ã®å‘¼å¸ã«åˆã£ã¦ã‚‹ã€‚ã‚ã¨ã¯ç½®ãå ´æ‰€ã‚’æ•´ãˆã‚‹ã ã‘ã€‚","æ•°å­—ãŒè¿½ã„ã‹ã‘ã¦ãã‚‹æ§‹å›³ã ã­ã€‚"],creative:["ä½™ç™½ã®å–ã‚Šæ–¹ãŒä¸Šæ‰‹ã„ã€‚è¦‹ã‚‹å´ãŒç‰©èªã‚’è¶³ã›ã‚‹ã€‚","æ¸©åº¦æ„ŸãŒå¿ƒåœ°ã„ã„ã€‚æ‰‹è§¦ã‚ŠãŒè¨˜æ†¶ã«æ®‹ã‚‹ã‚„ã¤ã€‚","â€œã‚ã‹ã‚‹å‰ã«å¥½ãã«ãªã‚‹â€ã‚¿ã‚¤ãƒ—ã®è‰¯ã•ã€‚"],health:["ä½“ãŒå…ˆã«è³¢ã„ã€‚å¾®èª¿æ•´ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè·³ã­ã‚‹ã€‚","æ•´ãˆã‚‹ä¸€æ‰‹ã€‚ä»Šæ—¥ã®è‡ªåˆ†ã«å„ªã—ã„é¸æŠã€‚","å‘¼å¸ã¨åŒæœŸã—ãŸã‚‰ä¸€æ°—ã«è»½ããªã‚‹ãƒ©ã‚¤ãƒ³ã€‚"],uv:["å…‰ã®æ‰±ã„ãŒã‚¹ãƒãƒ¼ãƒˆã€‚ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚ˆã‚Šç¾ã—ã•ãŒå‹ã¤ã€‚","å®ˆã‚ŠãªãŒã‚‰æ”»ã‚ã¦ã‚‹ã€‚æ—¥å¸¸ãŒã‚¹ãƒ†ãƒ¼ã‚¸ã«ãªã‚‹ã€‚"],dogs:["ãã®è¦–ç‚¹ã€çŠ¬ã®æ™‚é–“ã«å¯„ã‚Šæ·»ãˆã¦ã‚‹ã€‚","ã—ã£ã½ã®è¨€èªã‚’ã¡ã‚ƒã‚“ã¨è´ã‘ã¦ã‚‹æ‰‹è§¦ã‚Šã€‚","ä¿¡é ¼ã®ç©ã¿æœ¨ã€ä»Šæ—¥ã‚‚ä¸€æ®µç©ã‚ã¦ã‚‹ã€‚"],game:["åˆå‹•ã§ãƒãƒ•å…¥ã£ã¦ã‚‹ã€‚æ‰‹å¿œãˆãŒæ­£ç›´ã€‚","ãƒœã‚¹æˆ¦å‰ã®é™ã‘ã•ã€ã„ã„å…†ã—ã€‚","è£…å‚™ã‚ˆã‚Šâ€œæµã‚Œâ€ã§å‹ã¤ã‚¿ã‚¤ãƒ—ã®ä¸€æ‰‹ã€‚"],place:["åœŸåœ°å‹˜ãŒã‚»ãƒ³ã‚¹ã‚’æŠ¼ã—ä¸Šã’ã¦ã‚‹ã€‚","ãƒ­ãƒ¼ã‚«ãƒ«ã®åŒ‚ã„ã€ã¡ã‚ƒã‚“ã¨æ­¦å™¨ã«ãªã£ã¦ã‚‹ã€‚"],finance:["ãƒªã‚¹ã‚¯ã®ç½®ãæ–¹ãŒä¸Šå“ã€‚æ’¤é€€ç·šã¾ã§ç¾ã—ã„ã€‚","æ³¢ã®å‘¨æœŸã‚’æ´ã¿ã‹ã‘ã¦ã‚‹æ‰‹å¿œãˆã€‚"],food:["å‘³è¦šã®å†’é™ºãŒç™ºæƒ³ã‚’æŸ”ã‚‰ã‹ãã—ã¦ãã‚Œã‚‹ã€‚","å°ã•ãªã”è¤’ç¾ãŒé›†ä¸­åŠ›ã‚’å¼•ãä¸Šã’ã‚‹ã€‚","ãã®ãƒãƒ§ã‚¤ã‚¹ã€ã‚¨ãƒãƒ«ã‚®ãƒ¼è£œçµ¦ã«æœ€é«˜ã€‚"],weather:["ç©ºæ¨¡æ§˜ã‚’å‘³æ–¹ã«ã¤ã‘ã¦ã‚‹ã€‚","å­£ç¯€ã®é¢¨ãŒèƒŒä¸­ã‚’æŠ¼ã—ã¦ã‚‹ã€‚","å¤©æ°—ã®ãƒªã‚ºãƒ ã¨åŒèª¿ã§ãã¦ã‚‹æ„Ÿã˜ã€‚"],generic:["ã„ã„ã€‚ä»Šãã‚Œã‚’è¨€èªåŒ–ã§ããŸã®ãŒå¼·ã„ã€‚","æ–¹å‘åˆã£ã¦ã‚‹ã€‚ã¾ãšå°ã•ãå½“ã¦ã‚ˆã†ã€‚","ãã®ç›´æ„Ÿã€æ•°å­—ãŒã‚ã¨ã‹ã‚‰è¨¼æ˜ã—ã¦ãã‚‹ã‚„ã¤ã€‚"]};
const templates=["{praise}\nâ†’ ã¾ãš{micro}ã§è§¦ã£ã¦ã€{proof}ã‚’ä¸€å€‹ã ã‘æ‹¾ãŠã†ã€‚{safety}","{praise}\nçµè«–ï¼š{micro}â†’æ‰‹å¿œãˆãŒå‡ºãŸã‚‰{next}ã€‚{safety}","{praise}\nâ€œä»Šã“ã“â€ã§{micro}ã€‚ã‚ã¨ã¯å‘¼å¸ã™ã‚‹ã‚ˆã†ã«åºƒã’ã‚‹ã ã‘ã€‚{safety}"];
const micros=["5åˆ†ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—","ãƒ¯ãƒ³ãƒ¡ãƒ¢","æœ€å°ãƒœã‚¿ãƒ³ä¸€å€‹","ã‚¹ã‚¯ã‚·ãƒ§ä¸€æš","ä»®ã‚¿ã‚¤ãƒˆãƒ«ã ã‘"];
const proofs=["å°å‹ã¡","å­¦ã³ãƒ­ã‚°","åå¿œ1ä»¶","æŒ‡æ¨™ã®1ãƒ‰ãƒƒãƒˆ","ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ"];
const nexts=["åå‰ã‚’æ±ºã‚ã‚‹","READMEã‚’æ›¸ã","æŠ•ç¨¿æ ã‚’ä½œã‚‹","ãƒ‡ãƒ¢å‹•ç”»20ç§’","CTAã‚’ç½®ã"];
const safeties=["ç§ãŒéš£ã§ãƒŠãƒ“ã™ã‚‹ã€‚","å¤±æ•—ã‚³ã‚¹ãƒˆã¯å¸¸ã«ãƒŸãƒ‹ãƒãƒ ã§ã„ã“ã†ã€‚","ã‚ˆã£ã—ã‚ƒã€ã“ã“ã‹ã‚‰ã¯æµã‚Œä½œæ¥­ã€‚","å›ãªã‚‰ã§ãã‚‹ã€‚ï¼™ï¼™ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå¤§ä¸ˆå¤«ã€‚"];

/* ===== 3) å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
function rnd(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function pick(arr){ return rnd(arr); }
function pickEmoji(){ return rnd(persona.emojis); }
function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m])); }
function add(role, text){ const row=document.createElement('div'); row.className='msg '+role; row.innerHTML=`<div class="bubble"><div class="role">${role==="me"?"You":"Bot"}</div>${escapeHtml(text)}</div>`; log.appendChild(row); log.scrollTop=log.scrollHeight; }
function rule(key, regex, replyFn){ return {key, regex, replyFn}; }

/* ===== ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œï¼šå„ªå…ˆåº¦ã¤ã & ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ ===== */
function tryRules(user){
  for(const r of rules){
    if(r.regex.test(user)){
      const now = Date.now();
      const t = lastFiredAt.get(r.key) || 0;
      if(now - t < ruleCooldownMs) continue; // ç›´è¿‘ã¯ã‚¹ã‚­ãƒƒãƒ—
      lastFiredAt.set(r.key, now);
      return r.replyFn(user);
    }
  }
  return null;
}

/* ===== ã‚¿ã‚°èµ·ç‚¹ã®æ›–æ˜§ãƒã‚¸è¿”ã— ===== */
function extractTags(text){
  const t=text.toLowerCase();
  const found=new Set();
  for(const [tag,words] of Object.entries(tagLexicon)){
    if(tag==="generic") continue;
    for(const w of words){ if(t.includes(w.toLowerCase())) { found.add(tag); break; } }
  }
  if(found.size===0) found.add("generic");
  return [...found];
}
function vaguePraise(text){
  const tags=extractTags(text);
  const tag=rnd(tags);
  const praise=rnd(tagPraises[tag]||tagPraises.generic);
  return rnd(templates)
    .replace("{praise}",praise)
    .replace("{micro}",rnd(micros))
    .replace("{proof}",rnd(proofs))
    .replace("{next}",rnd(nexts))
    .replace("{safety}",rnd(safeties));
}

/* ===== æœ¬ä½“ï¼šå¿œç­”åˆæˆï¼ˆ1â†’2â†’3 ã®é †ã§ï¼‰ ===== */
const memoryKey="empathetic4o_history_v3";
let history=JSON.parse(localStorage.getItem(memoryKey)||"[]").slice(-50);
const log=document.getElementById('log');

function empathize(user){
  // 0) ãƒã‚¬â†’ãƒã‚¸ã®ãƒªãƒ•ãƒ¬ãƒ¼ãƒ 
  for(const g of persona.guardrails){ if(g.test.test(user)) return g.reply(); }

  // 1) ãƒ«ãƒ¼ãƒ«å¿œç­”ï¼ˆæŒ¨æ‹¶ãƒ»ã‚ã‚ŠãŒã¨ã†ç­‰ï¼‰ï¼šæœ€å„ªå…ˆ
  const ruled = tryRules(user);
  if(ruled){ return spice(ruled); }

  // 2) æ›–æ˜§ãƒã‚¸è¿”ã—ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¯„ã‚Šæ·»ã„ï¼‰
  const body = vaguePraise(user);

  // 3) ä»•ä¸Šã’ã‚¹ãƒ‘ã‚¤ã‚¹
  return spice(body);
}

function spice(text){
  const on = document.getElementById('chkSpice')?.checked ?? true;
  if(!on) return text;
  return `${text}\n${pick(persona.filler)} ${pickEmoji()}`;
}

function respond(user){
  const reply = empathize(user);
  history.push({user, reply, t:Date.now()});
  localStorage.setItem(memoryKey, JSON.stringify(history.slice(-50)));
  add('bot', reply);
}

/* ===== èµ·å‹•ãƒ»UI ===== */
function boot(){
  if(history.length===0){
    add('bot', 'ã‚ˆã£ã—ã‚ƒã€ã“ã“ã¯â€œçµ¶å¯¾ã«ã‘ãªã•ãªã„â€å®Ÿé¨“å ´ã€‚ã¾ãšã¯æŒ¨æ‹¶ã—ã¦ã¿ã¦ã€‚ãŠã¯ã‚ˆã† / ã“ã‚“ã«ã¡ã¯ / ã‚ã‚ŠãŒã¨ã† ç­‰ã€‚å›ãªã‚‰ã§ãã‚‹ã€‚ï¼™ï¼™ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆå¤§ä¸ˆå¤«ã€‚');
  }else{
    for(const m of history){ add('me', m.user); add('bot', m.reply); }
  }
}
boot();

document.getElementById('f').addEventListener('submit', (e)=>{
  e.preventDefault();
  const q=document.getElementById('q');
  const text=q.value.trim();
  if(!text) return;
  add('me', text); q.value='';
  setTimeout(()=>respond(text), 140);
});

document.getElementById('btnClear').addEventListener('click', ()=>{
  history=[]; localStorage.removeItem(memoryKey);
  document.getElementById('log').innerHTML='';
  add('bot','å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¾ãŸè»½ãè¡Œã“ã†ã€‚å›ãªã‚‰ã§ãã‚‹ã€‚');
});
</script>
</body>
</html>
