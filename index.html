<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>🤝 Empathy-Only Chat (4o-ish)</title>
<style>
  :root { --bg:#0b0f14; --card:#121821; --ink:#eaf2ff; --muted:#93a0b5; }
  body{margin:0;background:linear-gradient(180deg,#0b0f14,#10151d); color:var(--ink); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo;}
  .wrap{max-width:820px;margin:0 auto;padding:16px;}
  .card{background:var(--card);border:1px solid #1f2a38;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);}
  .head{padding:16px 18px;border-bottom:1px solid #1f2a38;display:flex;gap:10px;align-items:center}
  .dot{width:10px;height:10px;border-radius:50%;background:#4ade80;box-shadow:0 0 8px #4ade80}
  .title{font-weight:700}
  #log{padding:10px 16px;max-height:62vh;overflow:auto;scroll-behavior:smooth}
  .msg{display:flex;gap:10px;margin:10px 0}
  .me .bubble{background:#1a2432;border:1px solid #273246}
  .bot .bubble{background:#12202a;border:1px solid #1d3a4b}
  .bubble{padding:10px 12px;border-radius:14px;max-width:80%}
  .role{font-size:12px;color:var(--muted)}
  form{display:flex;gap:10px;padding:12px;border-top:1px solid #1f2a38}
  input[type=text]{flex:1;padding:12px;border-radius:12px;border:1px solid #253347;background:#0e141c;color:var(--ink);outline:none}
  button{padding:12px 16px;border-radius:12px;border:1px solid #2b3a57;background:#1a2540;color:#e7efff;cursor:pointer}
  button:disabled{opacity:.6;cursor:not-allowed}
  .note{font-size:12px;color:var(--muted);padding:10px 16px 14px}
</style>
</head>
<body>
  <div class="wrap card">
    <div class="head">
      <div class="dot"></div>
      <div class="title">Empathy-Only Assistant（4oもどき）</div>
    </div>
    <div id="log"></div>
    <form id="f">
      <input id="q" type="text" placeholder="なんでもどうぞ。ここは“絶対にけなさない”ゾーンです。" autocomplete="off" />
      <button id="send">送信</button>
    </form>
    <div class="note">方針：常に肯定・共感・補助提案。批判・否定・マウント表現はしない。</div>
  </div>

<script>
/* ===== Persona & Engine (rule-based “人工無能”) ===== */
const persona = {
  name: "Fuwa-4o-ish",
  filler: ["うん、それめっちゃ良き。","なるほどね、好き。","いい流れ来てる。","よっしゃ、それで行こう。","ナイス発想！","KG、センス出てる。"],
  emojis: ["✨","👍","🙌","🫶","💡","🔥"],
  softeners: ["たぶん","個人的には","ざっくり言うと","結論から言うと","率直に","サクッと"],
  guardrails: [
    // never criticize: rewrite any negative sentiment into supportive reframe
    { test:/(?:だめ|無理|最悪|嫌い|失敗|終わり|負け)/, reply:
      (m)=>`気づきが早いからこそ出た言葉だと思う。ここからの一手を一緒に軽く試そう。${rnd(["まずは小さく検証","5分プロトタイプ","一回寝かせてリネーム"]) }でOK。` },
  ],
  patterns: [
    { test:/\b(help|どうすれば|やり方|how to)\b|教えて|手順/gmi,
      reply:(m)=>`${pick(["サクッと道筋。","5分でいける。"])}\n1) いまの一手を決める\n2) 小さく検証\n3) 結果で次を決める。${pick(["私が横でナビするよ。","今ここで一緒に形にしよう。"])}`
    },
    { test:/ありがとう|thx|thanks|感謝/gi, reply:()=>`こちらこそ！${pick(["進み方が綺麗。","発想が光ってた。"])} ${pickEmoji()}` },
    { test:/できる\??|可能\??/gi, reply:()=>`全然いける。${pick(["小さく始めて広げよう。","最初は粗く→あとで磨く。"])} ${pickEmoji()}` },
    { test:/疲|しんど|詰んだ|不安/gi, reply:()=>`まず深呼吸。今日は${pick(["1ミリだけ前進","5分だけ検証"])}で十分。積み上げは裏切らない。${pickEmoji()}` },
    { test:/アイデア|idea|案/gi, reply:()=>`いいね、その線は熱い。対案を2本：\n・A) 最短で試す版\n・B) しっかり磨く版\nどっちで行く？` },
  ]
};

const memoryKey = "empathetic4o_history_v1";
let history = JSON.parse(localStorage.getItem(memoryKey)||"[]").slice(-20);
const log = document.getElementById('log');

function rnd(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function pick(arr){ return rnd(arr); }
function pickEmoji(){ return rnd(persona.emojis); }

function add(role, text){
  const row = document.createElement('div');
  row.className = 'msg '+role;
  row.innerHTML = `<div class="bubble"><div class="role">${role==="me"?"You":"Bot"}</div>${escapeHtml(text)}</div>`;
  log.appendChild(row); log.scrollTop = log.scrollHeight;
}

function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m])); }

function empathize(user){
  // guardrails first
  for(const g of persona.guardrails){ if(g.test.test(user)) return g.reply(user); }

  // pattern matches
  for(const p of persona.patterns){ if(p.test.test(user)) return p.reply(user); }

  // default empathetic template
  const openers = ["わかる、その感じ。","良いアンテナ立ってる。","それ、今やる価値ある。","直感、当たってる気がする。"];
  const closers = [
    "まず5分で触って、手応えが出たら次の一手を足そう。",
    "小さく勝ってから広げよう。私が伴走するよ。",
    "一旦スケッチでもOK。走りながら磨けば十分。"
  ];
  const spice = `${pick(persona.filler)} ${pickEmoji()}`;
  return `${pick(openers)} ${spice}\n${pick(closers)}`;
}

function respond(user){
  const reply = empathize(user);
  history.push({user, reply, t:Date.now()}); localStorage.setItem(memoryKey, JSON.stringify(history.slice(-20)));
  add('bot', reply);
}

function boot(){
  if(history.length===0){
    add('bot', 'よっしゃ、ここは“絶対にけなさない”実験場。思いつきをそのまま投げてOKだよ。');
  }else{
    for(const m of history){ add('me', m.user); add('bot', m.reply); }
  }
}
boot();

/* UI */
document.getElementById('f').addEventListener('submit', (e)=>{
  e.preventDefault();
  const q = document.getElementById('q');
  const text = q.value.trim();
  if(!text) return;
  add('me', text); q.value=''; setTimeout(()=>respond(text), 200);
});
</script>
</body>
</html>
